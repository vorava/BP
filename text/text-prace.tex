\chapter{Úvod}
Neuronové sítě (anglicky neural networks) mají v dnešním světě mnoho využití. Jelikož se jedná o jednu z aplikací umělé inteligence (anglicky artificial intelligence), lze neuronové sítě použít například k rozpoznávání řeči, zpracování přirozeného jazyka či k detekci objektů.
Tyto akce jsou pro běžného člověka poměrně snadné, avšak pro počítače znamenají relativně náročnou činnost.

Aby byly počítače schopné tyto akce vykonávat v rozumném čase (případně v reálném čase), je potřeba aby neuronové sítě byly dostatečně rychlé. Tato práce se zabývá akcelerací neuronových sítí v oblasti detekce obličeje. Zrychlení neuronové sítě lze dosáhnout buď optimalizací kódu, lepším trénováním neuronové sítě nebo také využitím speciálních hardwarových zařízení. Jedním z těchto specializovaných zařízení je Intel Neural Compute Stick 2, na něž se v této práci zaměřím. 

Následující kapitola se obecně věnuje problematice detekce obličeje v reálných podmínkách s využitím neuronových sítí. Je zde detailně popsáno \todo{CO JE DETAILNě Popsáno?}.

V kapitole \ref{kapitola:navrh_reseni} je nastíněn návrh akcelerace neuronové sítě pro detekci obličeje. \todo{\blindtext}

Kapitola \ref{kapitola:implementace} se věnuje implementaci programu ke zrychlení detekce, také obsahuje informace o využitých prostředcích.

Předposlední kapitola (kapitola č.\ref{kapitola:porovnani_vykonnosti}) poskytuje přehled experimentů a testů provedených s implementovaným řešením a s řešeními již existujícími. Hlavním tématem v této části je porovnání výkonnosti a zobrazení dosažených výsledků.

\nocite{*}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%       KAPITOLA 2
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Kamery a systémy pro detekci obličejů}
\label{kapitola:kamery_a_systemy}
Detekci obličejů s využitím počítačových programů lze provádět nad snímkem 
(fotografií, obrázkem), sadou snímků,
videozáznamem nebo tzv. real\,--\,timově pomocí kamer a kamerových systémů.
V této kapitole jsou popsány aktuálně využívané prostředky pro vytváření 
podkladů k detekci obličejů (kamery) a také dostupná řešení zabývající se 
detekcí, a to jak placené komerční, tak neplacené open-source systémy.

\section{Kamery}
Nezbytnou součástí oboru detekce obličejů jsou kamery a kamerové systémy.
Existují kamery specializované k detekci či rozpoznávání obličejů 
a kamery obyčejné, které pouze zprostředkovávají obraz dále ke zpracování.

Specializované kamery se používají například k zabezpečení objektů nebo
jako domovní videozvonky, kdy kamera (respektive její software) v zachyceném
obraze detekuje a rozpozná obličej, a následně může vykonat přiřazenou akci 
(spustit alarm, poslat notifikaci, umožnit osobě vstup...) \cite{securityCamsWeb}.

Další oblastí, kde se kamery s detekcí a rozpoznáváním obličejů uplatní je
bezesporu dohled ve veřejných prostorech (anglicky CCTV surveillance). 
Detekce obličeje může sloužit k hledání podezřelých osob v záznamech z dohledových
kamer. Tyto záznamy jsou shromážďovány na serveru, pomocí detekce jsou
z obrazu vyřezány fragmenty s obličeji lidí a poté jsou tyto fragmenty
porovnány rozpoznávacím algoritmem s obličeji hledaných osob. Při shodě
dochází k informování administrátora systému, který podnikne další kroky 
\cite{suspectIdentification}. 

Kamery tedy mají v doméně detekce obličejů nezastupitelnou roli, na 
jejich praktické využití v systémech a řešení pro detekci se zaměřuje následujících
podkapitola.

\section{Dostupná řešení}
Řešení umožňující detekci (a často i rekognici) obličejů lze rozdělit do dvou kategorií: 
komerční (placené, profesionální) a nekomerční (zdarma, open-source, amatérské).
V následujících dvou podkapitolách jsou popsány konkrétní systémy poskytující
detekci obličejů s jejich výhodami a nevýhodami.

\subsection*{Komerční}
Komerčně využívaná zařízení pro detekci, případně rekognici lze běžně zakoupit 
a používat ve firemním nebo domácím prostředí. Mezi zástupce těchto zařízení
patří například produkty firem Netatmo, Google, Nest \cite{securityCamsWeb2}.

\begin{figure}[H]
  \begin{center}
      \scalebox{0.5}{\includegraphics{obrazky-figures/nest-hello.png}}
  \label{nest}
  \caption{Nest Hello \cite{securityCamsWeb2}}
  \end{center}
\end{figure}

\subsection*{Nekomerční}
Nekomerční řešení pro detekci obličejů zahrnují frameworky s otevřeným zdrojovým
kódem (open-source). Tyto frameworky využívají neuronové sítě, které jsou trénovány
pomocí datasetů a následně je framework využit k detekci obličeje 
\cite{faceRecognitionFrameworks}.
Frameworky TinaFace \cite{TinaFace} a MTCNN \cite{MTCNN} mají zdrojové kódy
volně dostupné na webu GitHub.com.





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%       KAPITOLA 3
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Detekce obličeje v reálných podmínkách}
\label{kapitola:detekce_obličeje}
Detekce obličeje (anglicky face detection) \cite{fdReview, frReview} je technologie, která umožňuje v digitálním obrázku lokalizovat lidský obličej. Detekce obličeje patří do skupiny technologií HCI (Human--Computer interaction).
Detekovat obličej je poměrně jednoduchý úkol pro lidi, ale zároveň se jedná o relativně náročný úkol pro počítače.
Detekce obličeje je výchozím bodem pro další algoritmy analyzující lidský obličej, jako je například (v závorce za pojmem následuje anglický překlad):
\begin{itemize}
  \item rozpoznávání obličeje (face recognition),
  \item zarovnání obličeje (face alignment),
  \item ověřování pomocí obličeje (face verification/authentication),
  \item sledování pohybu hlavy (head pose tracking),
  \item určování věku nebo pohlaví (age/gender recognition),
  \item[] a mnoho dalších. 
\end{itemize}

Samotná detekce obličeje se v realném prostředí využívá například v oblasti fotografování (automatické ostření na tvář), marketingu (zjišťování zájmu zákazníku o produkty podle počtu výskytu obličejů) nebo bezpečnosti (bezpečnostní kamery a systémy).

Následující podkapitoly se zabývají principem fungování detekce obličeje v reálných podmínkách a problémy a omezeními, které se v běžném světě vyskytují a detekce by si s nimi měla umět poradit (špatné světelné podmínky, příliš členité pozadí, přílišný počet obličejů v obrázku, barva kůže, nízké rozlišení atd.). Na konci této kapitoly se nachází popis algoritmů a detektorů, které ke svému fungování nepoužívají přímým způsobem neuronové sítě.

\begin{figure}[H]
  \begin{center}
      \scalebox{0.31}{\includegraphics{obrazky-figures/fdexample.png}}
  \label{fdexample}
  \caption{Příklad detekce obličeje}
  \end{center}
\end{figure}

\section{Detekce obličeje}
Detekci obličeje lze rozdělit do několika přístupů, vědecké práce na toto téma se liší a nelze jasně říci zda to či ono dělení je jediné korektní.

Dle \cite{fdReview} existují 2 různé přístupy k hledání tváří v obrázcích, a to \textbf{přístup založený na vlastnostech} (anglicky feature based approach) a \textbf{přístup založený na obrázku} (anglicky image based approach). 
\textbf{Přístup založený na vlastnostech} nepoužívá přímo k detekci obličeje umělou inteligenci a neuronové sítě. Využívá vlastností obličeje jako takového (rysy, pozice očí, uší, obočí, barvu kůže\dots). Efektivita tohoto přístupu se snižuje s výskyty problémů popsaných v sekci \ref{sekce:problemy}, protože může docházet například k zakrytí nebo špatné viditelnosti některých vlastností obličeje.

Naproti tomu \textbf{obrazový přístup} uplatňuje schopnosti neuronových sítí a umělé inteligence k natrénování modelu neuronové sítě a následné přímé detekci pomocí tohoto modelu. 

Podle \cite{feature-based-fd-review} lze rozdělit metody detekce obličeje do 4 základních kategorií (viz obrázek \ref{fddeleni}) a 2 zvláštních kategorií (Haarovy vlastnosti a umělá inteligence).
\begin{figure}[H]
  \begin{center}
      \scalebox{0.9}{\includegraphics{obrazky-figures/fddeleni.png}}
  \label{fddeleni}
  \caption{Dělení metod detekce obličeje dle \cite{feature-based-fd-review}}
  \end{center}
\end{figure}

\textbf{Feature-based methods} (metody založené na vlastnostech) opět pracují s vlastnostmi obličeje. Vyhledávají v obraze rysy obličeje, což může výrazně ztížit či znemožnit neviditelnost některých rysů. Výhodou těchto metod je rychlost v porovnání s ostatními metodami.

\textbf{Appearance-based methods} (metody založené na vzhledu/obrázku) využívají klasifikace vlastností tváře do 2 tříd v podobrázku celého obrázku. Klasifikátory podle nichž se daná metoda rozhoduje, zda se jedná o tvář či nikoli, mají různé váhy, metoda postupuje od slabých klasifikátorů k silnějším.

Metody založené na znalostech (\textbf{Knowledge-based mathods}) se uplatňují při detekci obličeje v obrázku s čelnitým/komplexním pozadím. Znalosti které k detekci pomáhají jsou například ty, že obličej má 2 uši, jeden nos, jedny ústa nebo vzdálenosti mezi jednotlivými rysy obličeje.

\textbf{Templatematching} (šablonování, maskování) aplikuje na obrázek předem danou ma-sku obličeje a snaží se detekovat obličej pomocí postupného maskování. Tato metoda je snadná na implementaci, jejím nedostatkem je však závislost na přímém pohledu tváře na obrázku.

Haarovy vlastnosti a budou popsány později.
Detekce pracující na principu rozpoznávání vlastností v obraze jsou popsány v sekci 
\ref{sekce:detektory_bez_neuronovych_siti}, 
detektory s využitím neuronových sítí popisuje sekce \ref{sekce:detektory_s_neuronovymi_sitemi}.



\section{Problémy a omezení}
\label{sekce:problemy}
Algoritmy pro detekci obličejů čelí několika výzvám a omezením spojených s ne vždy perfektním zobrazením obličeje v obrázku. Lidské obličeje na fotografiích a obrázcích mohou být částečně zakryté (např. sluneční brýle), mohou být pořízené za nevhodných světelných podmínek (např. zastínění části tváře) nebo mohou nabývat nedostatečné kvality (nízké rozlišení).

Jelikož tedy vstupní obrázek detekce obličeje nemusí být vždy ideální, nemusí být obličej vždy správně detekován.
V této sekci jsou popsány některé problémy \cite{feature-based-fd-review, fdReview}, které mohou bránit v úspěšné detekci. Minimalizace dopadu těchto jevů na detekci je klíčem k navýšení uspěšnosti detekce. Mezi problémy a omezení (viz obrázek \ref{fdproblems}) pro detekci patří pozice hlavy, zakrytí části/částí obličeje, špatně osvětlená scéna nebo výraz tváře.

\begin{figure}[H]
  \begin{center}
      \scalebox{0.5}{\includegraphics{obrazky-figures/fdproblems.png}}
  \label{fdproblems}
  \caption{Vybráné problémy při detekci obličejů. Převzato z \cite{frReview}. (a) Pozice hlavy; (b)~Zakrytí části obličeje; (c) Špatné světelné podmínky; (d) Výraz tváře}
  \end{center}
\end{figure}

\subsection*{Pozice hlavy}
Hlava může být na fotografii různě natočena, takže obličej nemusí být zachycen v přímém pohledu do kamery, ale může být zaznamenán z profilu nebo ze šikma (poloprofil) jako na obrázku \ref{fdproblems} část (a).

\subsection*{Zakrytí části obličeje}
Výsledek detekce může být ovlivněn i zakrytím části obličeje (rukou, brýlemi, vlasy, šátkem apod.).

\subsection*{Výraz tváře}
Výraz lidského obličeje mohou ovlivnit emoce a nálady. Detektor zabývající se detekcí a rozpoznáváním emocí \cite{emotionDetector} dosahuje přesnosti 96 \%.

\subsection*{Orientace obrázku}
Problémem pro detekci může být různá orientace obrázku (vzhůru nohama, zrcadlově otočený, natočený do strany apod.). Na obrázek je tak nutno aplikovat některé tranformační operace pro zarovnání.


\subsection*{Nedostatečně výkonná detekce}
Velmi důležitým faktorem při detekci obličejů, zvláště v real-timových aplikacích, je rychlost detekce. Pokud má algoritmu vysokou účinnost, ale je příliš pomalý pro vybranou aplikaci, stává se nepoužitelným. Zrychlováním detekčních algoritmů se zabývá několik vědeckých studií.

\subsection*{Příliš členité pozadí} 
Pokud se v o brázku nachází příliš mnoho objektů, může dojít ke snížení přesnosti a rychlosti detekce.

\subsection*{Přílišný počet obličejů v obrázku}
Výskyt velkého počtu obličejů v jednom obrázku, často překrývajících se, může představovat výzvu pro detekční algoritmus. 

\subsection*{Nízké rozlišení}
Obrázky a fotografie s nízkým rozlišením nemusejí obsahovat dostatek informace nutné ke správnemu detekování tváře.

\subsection*{Špatné světelné podmínky}
Na detekci mohou mít vliv světelné podmínky panující při pořizování zkoumané fotografie či videa. Aspekty jež světlo ovlivňuje jsou mj. jas, kontrast, barvy, stíny, ostrost. Tato práce se zabývá detekcí obličejů v záznamech, v nichž některý z těchto faktorů omezuje detekci.


\begin{figure}[H]
  \begin{center}
      \scalebox{0.8}{\includegraphics{obrazky-figures/illuminationexample.png}}
  \label{illuminationexample}
  \caption{Příklad stejného obličeje vyfoceného při různých světelných podmínkách. Převzato z \cite{feature-based-fd-review}}
  \end{center}
\end{figure}

\section{Detektory obličejů}
\label{sekce:detektory_bez_neuronovych_siti}
Existuje několik různých přístupů k detekci obličeje. Tato sekce se zaměřuje na detekci s využitím detektorů nezaložených primárně na neuronových sítích (neuronová síť není použita vůbec, nebo není použita k přímé detekci). Detektory obličeje využívající principy neuronových sítí k přímé detekci budou popsány v další kapitole.

\subsection*{Local Binary Patterns}
Algoritmus využívající \textbf{lokální binární vzory} (anglicky Local Binary Patterns -- dále jen LBP) pro popis struktury/textury obrázku má mnoho aplikací \cite{localBinaryPatterns}. Jedná se o jeden z nejvýkonnějších algoritmů pro popis textur v obrázcích. LBP algoritmus má vysokou účinnost detekce (89 \%) \cite{localBinaryPatternsTests} a nízkou výpočetní náročnost.
LBP pracuje s černobílými (anglicky gray-scale) obrázky a v originální verzi funguje tak, že každému pixelu přiřadí binární číselnou hodnotu, vypočítanou dle hodnot pixelů v 3 $\times$ 3 okolí daného pixelu. Každý tento pixel v okolí je ohodnocen buď 1 nebo 0 v závislosti na tom, zda jeho hodnota překročila stanovený práh (anglicky threshold), kterým je hodnota prostředního pixelu (obrázek \ref{lbp}).

\begin{figure}[H]
  \begin{center}
      \scalebox{0.8}{\includegraphics{obrazky-figures/lbp.png}}
  \label{lbp}
  \caption{Ukázka ohodnocení pixelu algoritmem LBP. Převzato z \cite{localBinaryPatterns}}
  \end{center}
\end{figure}

Algoritmus byl později vylepšen tak, aby uměl pracovat s různě velkým okolím, které navíc nemusí mít čtvercový tvar. Používané okolí ve tvaru kružnice je popsáno dvojicí $(P, R)$, kde $P$ je počet vzorkovacích bodů a $R$ je poloměr kružnice. Další vylepšení LBP algoritmu se týkalo definování tzv. uniformních vzorů (anglicky uniform patterns). Tyto vzory jsou ty vzory v nichž se vyskytují nejvýše 2 přechody z 1 na 0 a opačně. Příkladem uniformního vzoru na okolí $(8, 2)$ je 11100000 (1 přechod), či 00111000 (2 přechody). 

Lokální primitiva (obrázek \ref{lbpprimitives}) a histogramy vytvořené z takto získaných hodnot se využívají například k detekci obličejů.

\begin{figure}[H]
  \begin{center}
      \scalebox{0.8}{\includegraphics{obrazky-figures/lbpPrimitives.png}}
  \label{lbpprimitives}
  \caption{Lokální primitiva detekované algoritmem LBP. Převzato z \cite{localBinaryPatternsTests}}
  \end{center}
\end{figure}

\subsection*{Viola--Jones algoritmus}
Algoritmus \textbf{Viola--Jones} \cite{violaJonesArticle, violaJones}, někdy také nazývaný \textbf{Haar Cascades}, je obecně technika pro detekci objektů, vytvořená před vynalezením metody hlubokého učení. Používá se k detekci obličejů, částí těla, očí, úst atd. Dosahuje přesnosti detekce kolem 90 \% \cite{violaJones}. 

Princip fungování algoritmu spočívá v detekci hran a čár (obecně vlastností) v černobílém obrázku (hodnoty pixelů jsou na intervalu $<0; 1>$). Vybere se jedna z vlastností (některé z nich zobrazuje obrázek \ref{haarfeatures}) a vypočítá se průměrná hodnota pixelů ve všech obdélnících (obdélníky jsou dva, tři nebo čtyři). Rozdíl těchto hodnot pak určuje zda se jedná o hranu, čáru tzn. zda je daná vlastnost detekována. Pokud například budeme hledat vlastnost \emph{b)} z obrázku \ref{haarfeatures} a vypočtený rozdíl hodnot je blízký 1, detekce byla úspěšná (viz ukázka v obrázku \ref{haarexample}).

\begin{figure}[H]
  \begin{center}
      \scalebox{0.6}{\includegraphics{obrazky-figures/haarfeatures.png}}
  \label{haarfeatures}
  \caption{Haarovy vlastnosti. Převzato z \cite{violaJonesArticle}
  a) horizontální hrana; b) horizontální hrana; c) horizontální čára d) diagonála e) vertikální čára}
  \end{center}
\end{figure}

\begin{figure}[H]
  \begin{center}
      \scalebox{0.4}{\includegraphics{obrazky-figures/haarexample.png}}
  \label{haarexample}
  \caption{Příklad výpočtu detekce hrany dle vlastnosti b) z obrázku \ref{haarfeatures}. Bílý obdélník je nahrazen červeným pro lepší viditelnost.}
  \end{center}
\end{figure}

Algoritmus postupně prochází celý obrázek a hledá výskyt některé z vlastností. Toto procházení u obrázků s velkým počtem znamená enormní výpočetní nároky, protože je potřeba vždy počítat s hodnotami všech dotčených pixelů. Proto Viola a Jones \cite{violaJones} navrli
vylepšení nazvané anglicky \textbf{Integral Image}. To spočívá v tom, že všechny pixely stačí projít pouze 1x, a každý tento pixel lze ohodnotit sumou hodnot pixelů směrem nalevo a nahoru (důsledkem je, že pixel s nejnižším ohodnocení se nachází v levém horním rohu a pixel s nejvyšším ohodnocením v pravém dolním rohu). Následný výpočet průměrné hodnoty ukazuje obrázek \ref{integralimage}. 

\begin{figure}[H]
  \begin{center}
      \scalebox{0.7}{\includegraphics{obrazky-figures/integralimage.png}}
  \label{integralimage}
  \caption{Ukázka výpočtu hodnoty obdélníku v Haarově vlastnosti za pomoci vylepšení \textbf{Integral Image}. Převzato z \cite{violaJonesArticle}.}
  \end{center}
\end{figure}

Jelikož Haarových vlastností může být velké množství, bylo vybráno 6000 nejvíce vyhovujících, které se k detekci obličejů používají. Detekce je rozdělena na několik etap, v každé etapě je vyhledáván v části obrázku výskyt několika vlastností (počet s každou etapou roste), pokud se vyhledání nezdaří, není již dále daná část obrázku prohledávána. 


\subsection*{Histogram orientací gradientů}
Metoda HOG (anglicky Histograms of Oriented Gradients) \cite{hog, hog2} používá k detekci obličejů či postav histogramy orientovaných přechodů v obrázku, rozděleném dle mřížky na několik bloků (často například 8$\times$8 nebo 4$\times$4 pixelů). Pro každý pixel v takovémto bloku jsou vypočítány hodnoty gradientů -- velikost (magnitude) a směr (direction). Tyto hodnoty jsou pak přiřazeny do jednoho či více sloupců v histogramu popisujícím celý blok.

Tento histogram bývá rozdělen na 9 sloupců (rozmezí -- anglicky bin) vyjadřujících směr gradientu v úhlu na škále od 0$^\circ$ do 180$^\circ$, kdy každý sloupec odpovídá intervalu 20$^\circ$. Výslednému vektoru, který udává velikosti gradientů v jednotlivých úhlech se říká HOG deskriptor.

HOG využívá pro zlepšení detekce při zhoršených světelných podmínkách normalizaci HOG deskriptorů. Tato normalizace je prováděna na vektorech 4 sousedících bloků. Pokud je tedy vektor složen z 9 hodnot, vypočítá se normalizační vektor z $9 \times 4 = 36$ hodnot.

Výsledkem metody je obrázek (viz obrázek \ref{hogexample} reprezentovaný orientovanými gradienty, které umožňují detekovat osoby nebo obličeje.

\begin{figure}[H]
  \begin{center}
      \scalebox{0.5}{\includegraphics{obrazky-figures/hogexample.png}}
  \label{hogexample}
  \caption{Zleva výřez originálního obrázku převedený do šedotónové reprezentace, rozdělený obrázek na bloky, výstup metody HOG. Převzato z \cite{hog2}.}
  \end{center}
\end{figure}


\section{Detektory zaměřující se na špatné světelené podmínky}
Tématem této práce je detekce obličeje ve špatných světelných podmínkách. Detekcí za těchto okolností se zabývala řada prací a bylo vytvořeno několik detektorů \cite{}. V této sekci jsou popsány metody a algoritmy zaobírající se touto problematikou, včetně jejich úspěšnosti detekce při stanovených podmínkách.



%%%%%%%%%%%%%%%%%%%
%         KaPITOLA
%%%%%%%%%%%%%%%%%%%
\chapter{Neuronové sítě pro detekci obličeje}
Tato kapitola popisuje neuronové sítě a jejich využití pro detekci obličejů. Sekce \ref{sekce:NS} se věnuje popisu neuronových sítí obecně, v sekci \ref{sekce:datasety} jsou popsány datasety a jejich využití k trénování neuronových sítí. Sekce \ref{sekce:NSdetektory} se zabývá konkrétními detektory obličejů s využitím neuronových sítí a v sekci \ref{sekce:akcelerace} jsou zmíněny možnosti akcelerace detekčních algoritmů.

\section{Neuronové sítě}
\label{sekce:NS}

Neuronové sítě \cite{deeplearningbook, ns1994} umožňují nalezení neznámého řešení problému pomocí naučení se z podobných problémů u nichž známe řešení. Tyto umělé sítě jsou inspirovány biologickou nervovou soustavou lidí (lidským mozkem). Síla neuronových sítí se projevuje v úlohách zaměřených na detekci, rozpoznávání (objektů, lidí, obličejů, obecně vzorů -- anglicky patterns) a~zpracování dat. Existuje řada druhů neuronových sítí (konvoluční, hluboké, dopředné, rekurentní), pro detekci obličejů v obrázcích se nejčastěji používají konvoluční neuronové sítě (anglicky Convolutional Neural Networks -- CNN). 

Na princip fungování neuronových sítí může být nahlíženo jako na nelineární matematickou funkci, která převádí $X$ vstupů na $Y$ výstupů. Proces transformace vstupních informací na výstup je ovlivňován váhováním hodnot vně sítě. Tyto hodnoty vah jsou určovány při tzv. učení/trénování neuronových sítí. Pro správné natrénování neuronové sítě je potřeba dostatečného počtu vstupních trénovacích dat (obrázků, textů, hodnot) a~dostatečně výkonný hardware. 

\subsection*{Biologický neuron}
Jak již bylo zmíněno, inspirací neuronových sítí je biologická nervová soustava. V lidském mozku se nachází okolo $10^{11}$ neuronů (elektricky aktivních buněk spracovávajích signály). Vstupem těchto neuronů jsou tzv. dendrity, výstupy pak nazýváme axony. Jednotlivé neurony jsou navzájem propojeny tisíci spoji pojmenovanými synapse. Synapse zajišťují komunikaci mezi neurony.

Takto vytvořený paralelismus poskytuje mozku schopnost rychle zpracovávat informace. Neurony biologické i umělé pracují s váhovanými vstupy. Po překročení určitého prahu na vstupech je adekvátně upraven výstup neuronu. Klíčovou vlastností potom je způsobilost měnit hodnoty jednotlivých vah na základě externích vlivů. Tím dochází k učení sítě neuronů.

\subsection*{Perceptron}

Nejjednoduším modelem umělého neuronu je preceptron. Perceptron má $N$ vstupů, jejichž hodnoty $x$ jsou vynásobeny váhami $w$ a sesumovány dle vzorce \ref{vzorec:perceptron}.

\begin{equation} \label{vzorec:perceptron}
  a = \sum_{i=1}^{N} (w_i * x_i) + w_0 * x_0
\end{equation}

Hodnota $w_0$ se nazývá bias a jedná se o neměnnou vstupní hodnotu (často má hodnotu $+1$). Váhy a vstupy (včetně biasu) mohou být jak kladné, tak i záporné. Hodnota $a$ je po vypočtení předána tzv. \textbf{aktivační funkci}.

\begin{figure}[H]
  \begin{center}
      \scalebox{0.4}{\includegraphics{obrazky-figures/perceptron.png}}
  \label{obrazek:perceptron}
  \caption{Perceptron s N vstupy, biasem $x_0$ a aktivační funkcí $f$}
  \end{center}
\end{figure}

\subsection*{Aktivační funkce}
Aktivační funkce $f$ je matematická funkce, která určuje výstup neuronu (vzorec \ref{vzorec:aktivacni_fce}). Na výběru vhodné aktivační funkce závisí přesnost neuronové sítě. Funkce může být různá, pro příklad je zde uveden výstup rozlišující zda se jedná o kladné či záporné číslo nebo nulu (viz vzorec \ref{vzorec:vystup_aktivacni_fce}).

\begin{equation} \label{vzorec:aktivacni_fce}
  z = f(a)
\end{equation}

\begin{equation}
  \label{vzorec:vystup_aktivacni_fce}
   f(a) =
    \begin{cases}
      0       & \quad \text{pro } a = 0\\
      1       & \quad \text{pro } a > 0\\
      -1       & \quad \text{pro } a < 0
    \end{cases}
\end{equation}

\subsection*{Spojování perceptronů}
Spojením několika preceptronů lze vytvořit tzv. vrstvu (anglicky layer) perceptronů. Tytvo vrstvy se dělí na vstupní (anglicky input), výstupní (anglicky output) a skryté (anglicky hidden). Konkatenací vstupní, několika skrytých a výstupní vrstvy je možno vytvořit neuronovou síť připravenou k trénování.

\begin{figure}[H]
  \begin{center}
      \scalebox{0.22}{\includegraphics{obrazky-figures/nsexample.png}}
  \label{obrazek:nsexample}
  \caption{Propojení vrstev perceptronů do neuronové sítě}
  \end{center}
\end{figure}

\subsection*{Učení}
Aby neuronová síť mohla fungovat, musí se natrénovat (tzn. nastavit co nejlépe váhy na vstupech perceptronů). K trénování se používají data z datasetů (viz sekce \ref{sekce:datasety}). Trénování neuronových sítí lze rozdělit do 3 kategorií \cite{deeplearningbook}:

\begin{itemize}
  \item \textbf{Učení bez učitele} (anglicky unsupervised learning) -- tyto algoritmy procházejí data z datasetu a provádějí nad nimi shlukování do tzv. clusterů
  \item \textbf{Učení s učitelem} (anglicky supervised learning) -- každým datům z datasetu je přiřazena informace o požadvaném výstupu. Vstupy jsou zpracovány neuronovou sítí a podle chyby (rozdílu vstup/výstup) jsou upraveny parametry v neuronové síti
  \item \textbf{Posilované učení} (anglicky reinforcement learning) -- tento druh učení není vázán pouza na data z datasetu, ale navíc interaguje s prostředím
\end{itemize}

\subsection*{Chyby}
Abychom byli schopní aktualizovat váhy vstupů jednotlivých perceptronů, je potřeba měřit chybovost výstupu neuronové sítě. Jednou z možností měření chyby (využitelné například při lineární regresi) je \emph{mean squared error}. Dle vztahu \ref{vzorec:mse} je vypočítána chybovost a jsou upraveny váhy. Snahou je chybu co nejvíce zmenšit.

\begin{equation}
  MSE = \frac{1}{N} \sum_{i}^{N} (vystupNS - spravnyVystup)^2
\end{equation}

Při trénování může dojít k situaci, kdy neuronová síť zvládá zpracovávat trénovací data s velmi vysokou přesností, ale při použití testovacích (validačních) dat se chybovost zvyšuje. V takovémto případě mluvíme o \textbf{přetrénování} (anglicky overfitting). Druhým nežádoucím jevem, který může nastat je \textbf{nedotrénovanost} (anglicky underfitting) -- síť není dostatečně natrénovaná a dochází tak k vysoké chybovosti (příčinou je například málo trénovacích dat).


\begin{figure}[H]
  \begin{center}
      \scalebox{0.18}{\includegraphics{obrazky-figures/fitting.png}}
  \label{obrazek:fitting}
  \caption{Ukázka výstupu neuronové sítě při nedoučení, přeučení a dostatečně dobrém množství dat pro učení}
  \end{center}
\end{figure}


\section{Datasety}
\label{sekce:datasety}
Datasetem rozumíme soubor podobných dat (například obrázků obličejů, číslic, předmětů nebo textů). Pro detekci obličejů se využívají datasety obsahující fotografie a videa lidí z veřejně dostupných zdrojů (internet, televize) nebo jsou datasety přímo účelně vytvářeny (fotografování lidí) a následně je možné si je koupit. Data v datasetech je nutné tzv. oanotovat (označit na daném obrázku je). V případě tváří se může jednat například o věk osoby, pohlaví, rasu, aby bylo možné určit zda po klasifikaci neuronovou sítí výstup odpovídá požadovanému výsledku.

\subsection*{Datasety lidských obličejů}
Dataset \textbf{CelebFaces Attributes Dataset} (CelebA) \cite{celebA} obsahuje více než $200 000$ obrázků obličejů známých osobností. Obrázky obsahují fotografie pořízené z různých úhlů a jsou velmi dobře anotovány. Tento dataset je volně přístupný pro nekomerční účely.

\begin{figure}[H]
  \begin{center}
      \scalebox{0.6}{\includegraphics{obrazky-figures/celeba.png}}
  \label{obrazek:celeba}
  \caption{Příklady obličejů z datasetu CelebA}
  \end{center}
\end{figure}

Dataset \textbf{DigiFace1M} \cite{digiface1m} se skládá z 1 milionu snímků digitálně vytvořených obličejů (viz obrázek \ref{obrazek:digiface}), čímž se vyhýbá případným právním a etnickým problémům, které mohou být spojeny s využití tváří fyzických osob. Při použití tohoto datasetu umělých tváří společně s 200 až 2000 fotografiemi tváří reálných lidí lze dosáhnout podobných výsledků jako s datasety tvořenými čistě reálnými obličeji.

\begin{figure}[H]
  \begin{center}
      \scalebox{0.6}{\includegraphics{obrazky-figures/digiface.png}}
  \label{obrazek:digiface}
  \caption{Příklady vygenerovaných obličejů pod různými úhly a různým osvětlením \cite{digiface1m}}
  \end{center}
\end{figure}

\textbf{Multi-PIE} \cite{multipie} je dataset zaměřený na fotografie obličejů pořízených za různých světelných podmínek a pod různými úhly. Obshauje přes 750000 snímků, které byly vytvořeny vyfotografováním 337 lidí po dobu několika měsíců. Tento dataset je placený.

Dataset \textbf{UTKFace} \cite{utkface} obsahuje přes 20000 fotek obličejů lidí různých věků, pohlaví a ras z různých úhlů a za rozličných světelných podmínek. Dataset je volně dostupný pro nekomerční použití. Data jsou podrobně anotovány dle vzorce \texttt{[věk]\_[pohlaví]\_[rasa]\_[datum a čas].jpg}, kde věk je v rozmezí 0--116 let, pohlaví muž/žena, rasa je jedna z výčtu běloch, černoch, asiat, ind, ostatní a datum a čas uchovává informaci o okamžiku zařazení fotografie do datasetu.

\section{Detektory obličeje}
\label{sekce:NSdetektory}

\subsection*{Konvoluční neuronové sítě}

\subsection*{Detektory zaměřující se na špatné světelené podmínky}

\section{Akcelerace detekce}
\label{sekce:akcelerace}

\subsection*{Intel Neural Compute Stick 2}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%       KAPITOLA 4
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Implementace algoritmu pro akceleraci detekce obličeje}
\label{kapitola:implementace}


\section{Použité nástroje}


\section{Trénování neuronové sítě}


\section{Detekce obličejů natrénovanou sítí}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%       KAPITOLA 5
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Porovnání výkonnosti řešení s existujícími detektory}
\label{kapitola:porovnani_vykonnosti}


\section{Postup testování}


\section{Porovnání výsledků}


\section{Shrnutí}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%       KAPITOLA 6
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter{Závěr}
\label{kapitola:zaver}
